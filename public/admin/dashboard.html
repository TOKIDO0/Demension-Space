<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>维度空间 | 核心控制台 v2.0</title>
    <!-- 引用新的样式文件 -->
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="/admin/glass_panel.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="bg-layer">
        <div class="star-field"></div>
        <div class="nebula"></div>
    </div>

    <div class="admin-root">
        
        <!-- 1. 登录界面 -->
        <div id="login-view" class="view-section">
            <div class="login-container">
                <div class="login-card-glass"></div>
                <div class="login-content">
                    <div class="holo-circle"></div>
                    <div class="login-header">
                        <h2 class="glitch-text" data-text="DIMENSION">DIMENSION</h2>
                        <p class="subtitle">需要系统最高权限</p>
                    </div>
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <div class="input-group">
                            <input type="email" id="email" required autocomplete="off">
                            <label>操作员 ID (邮箱)</label>
                            <span class="bar"></span>
                            <span class="highlight"></span>
                        </div>
                        <div class="input-group">
                            <input type="password" id="password" required autocomplete="off">
                            <label>访问代码 (密码)</label>
                            <span class="bar"></span>
                            <span class="highlight"></span>
                        </div>
                        <button type="submit" id="login-btn" class="cyber-btn">
                            <span class="btn-content">初始化神经连接</span>
                            <span class="btn-glitch"></span>
                            <span id="login-loading" class="loading-spinner" style="display:none;"> [链路建立中...]</span>
                        </button>
                        <div id="login-error" class="error-msg"></div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 2. 控制台 (左右布局) -->
        <div id="dashboard-view" class="view-section dashboard-layout" style="display: none;">
            
            <!-- 左侧：侧边栏 -->
            <aside class="sidebar sidebar-glass">
                <div class="sidebar-header">
                    <div class="brand-icon"></div>
                    <span>DIMENSION</span>
                </div>
                
                <nav class="sidebar-nav">
                    <div class="nav-label">核心模组</div>
                    
                    <button class="nav-item active" onclick="switchView('messages')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg>
                        <span>信号接收 (留言)</span>
                    </button>

                    <button class="nav-item" onclick="switchView('projects')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>
                        <span>作品矩阵 (项目)</span>
                    </button>

                    <button class="nav-item" onclick="switchView('reviews')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 5h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H8l-4 3V7a2 2 0 0 1 2-2z"></path></svg>
                        <span>信号回想 (评价)</span>
                    </button>

                    <div class="nav-label">系统设置</div>
                    
                    <button class="nav-item" onclick="showToast('功能模块开发中...')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
                        <span>系统参数</span>
                    </button>
                </nav>

                <div class="sidebar-footer">
                    <div class="user-mini-profile">
                        <div class="status-dot"></div>
                        <span id="current-user-email">OPERATOR</span>
                    </div>
                    <button id="logout-btn" class="logout-icon-btn" title="断开连接">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                    </button>
                </div>
            </aside>

            <!-- 右侧：内容区 -->
            <main class="main-content">
                
                <!-- 视图 1: 留言管理 -->
                <section id="view-messages" class="content-panel active-panel glass-panel">
                    <div class="panel-header-bar">
                        <h3 class="panel-title">INCOMING TRANSMISSIONS // 客户留言</h3>
                        <div class="panel-actions">
                            <div class="select-wrapper">
                                <select id="status-filter">
                                    <option value="all">所有状态</option>
                                    <option value="unread">未读</option>
                                    <option value="read">已读</option>
                                    <option value="replied">已回复</option>
                                    <option value="important">仅显示重要</option>
                                </select>
                            </div>
                            <button id="trash-btn" class="hud-btn-outline" title="查看回收站">回收站</button>
                            <button onclick="fetchMessages()" class="hud-btn-icon" title="刷新">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>
                            </button>
                        </div>
                    </div>
                    <div class="table-scroll-area custom-scrollbar">
                        <table class="holo-table">
                            <thead>
                                <tr>
                                    <th>时间戳</th><th>身份 ID</th><th>通讯频段</th><th>信息载荷</th><th>状态</th>
                                </tr>
                            </thead>
                            <tbody id="message-list"></tbody>
                        </table>
                    </div>
                </section>

                <!-- 视图 2: 项目管理 -->
                <section id="view-projects" class="content-panel glass-panel" style="display:none;">
                    <div class="panel-header-bar">
                        <h3 class="panel-title">PROJECT MATRIX // 作品矩阵</h3>
                        <div class="panel-actions">
                            <button onclick="openUploadModal()" class="cyber-btn-small">
                                + 上传新作品
                            </button>
                        </div>
                    </div>
                    <div id="project-grid" class="project-grid custom-scrollbar glass-panel">
                        <div class="loading-text">正在加载矩阵数据...</div>
                    </div>
                </section>

                <!-- 视图 3: 客户评价管理 -->
                <section id="view-reviews" class="content-panel glass-panel" style="display:none;">
                    <div class="panel-header-bar">
                        <h3 class="panel-title">SYSTEM FEEDBACK // 客户评价</h3>
                        <div class="panel-actions"></div>
                    </div>
                    <div id="reviews-root" class="custom-scrollbar" style="width:100%"></div>
                </section>

            </main>
        </div>
    </div>
    
    <div id="toast-notifications" class="toast-wrapper"></div>
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal-content glass-panel">
            <h3 id="modal-title"></h3>
            <div id="modal-body"></div>
            <div class="modal-actions">
                <button id="modal-cancel" class="cyber-btn-small cancel">取消</button>
                <button id="modal-confirm" class="cyber-btn-small">确认</button>
            </div>
        </div>
    </div>
    
    <!-- 引用新的逻辑文件 -->
    <script src="glass_modal.js"></script>
    <script src="dashboard.js?v=fix14"></script>
    <script src="visual_effects.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="text/babel" src="ReviewManagementPanel.jsx" data-presets="env,react"></script>
    <script type="text/babel">
      window.__renderReviewsPanel = function() {
        try {
          const el = document.getElementById('reviews-root');
          if (el && window.ReviewManagementPanel) {
            ReactDOM.createRoot(el).render(React.createElement(window.ReviewManagementPanel));
          }
        } catch (e) { console.error(e); }
      };
      document.addEventListener('DOMContentLoaded', () => {
        if (document.getElementById('reviews-root')) {
          try { window.__renderReviewsPanel && window.__renderReviewsPanel(); } catch(_) {}
        }
      });
    </script>
</body>
</html>
