<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta HTTP-EQUIV="pragma" CONTENT="no-cache">
    <meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
    <meta HTTP-EQUIV="expires" CONTENT="0">
    <title>客户报表</title>
    <link rel="stylesheet" href="../../css/element.css">
    <link rel="stylesheet" href="../../css/base.css">
</head>
<body>
<div id="wrapper" v-cloak>
    <div style="padding-bottom: 10px">
        <el-breadcrumb separator-class="el-icon-arrow-right">
            <el-breadcrumb-item @click.native="parent.changeIndex('index')">首页</el-breadcrumb-item>
            <el-breadcrumb-item>客户报表</el-breadcrumb-item>
        </el-breadcrumb>
    </div>

    <div style="height: 1px; margin: 10px 0; background-color: white"></div>
    <el-input v-model="search" style="width: 20%;" suffix-icon="el-icon-search" placeholder="请输入项目代码搜索" @keyup.enter.native="generateTable"></el-input>
    <el-button @click="generateTable" type="primary" style="margin: 10px 0">查询</el-button>

    <el-card>
    <div class="main">
        <div class="body">
            <div class="title">
                <div class="div1">
                    <div class="divCtn">
                        <div class="titleCtn">&nbsp;客&nbsp;&nbsp;户&nbsp;&nbsp;报&nbsp;&nbsp;表&nbsp;</div>
                        <div class="titleUdeLine"></div>
                    </div>
                </div>
                <div class="div2">NO：<span style="color: #9C5223;">{{entity.id}}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>
            </div>
            <div class="date">
                <div class="deDiv1">&nbsp;&nbsp;{{Year}}年&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{Month}}月&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{Date}}日&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div class="deDiv2">小区号&nbsp;&nbsp;&nbsp;{{entity.communityid}}&nbsp;&nbsp;&nbsp;&nbsp;</div>
            </div>
            <table border="1" style="width: 100%; border-collapse: collapse;">
                <tr class="tempTr2">
                    <td colspan="6" style="border-right-color: #FFFFFF; width: 50%; text-align: left;">&nbsp;&nbsp;客户名称&nbsp;&nbsp;&nbsp;&nbsp;{{entity.name}}</td>
                    <td colspan="6" style="width: 50%;">&nbsp;项&nbsp;目&nbsp;经&nbsp;理&nbsp;id&nbsp;{{entity.manangerid}}</td>
                </tr>
                <tr>
                    <td align="center" rowspan="2" style="width: 60%;">项&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;目&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;款&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;项</td>
                    <td colspan="10" align="center" style="width: 10%;">金&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;额</td>
                    <td rowspan="2" align="center" style="width: 30%;">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注</td>
                </tr>
                <tr class="tempTr1">
                    <td>￥</td>
                    <td>百</td>
                    <td>十</td>
                    <td>万</td>
                    <td>千</td>
                    <td>百</td>
                    <td>十</td>
                    <td>元</td>
                    <td>角</td>
                    <td>分</td>
                </tr>
                <tr class="tempTr2">
                    <td>合&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;总&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;造&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价</td>
                    <td>￥</td>
                    <td>{{entity.finalmoney[0]}}</td>
                    <td>{{entity.finalmoney[1]}}</td>
                    <td>{{entity.finalmoney[2]}}</td>
                    <td>{{entity.finalmoney[3]}}</td>
                    <td>{{entity.finalmoney[4]}}</td>
                    <td>{{entity.finalmoney[5]}}</td>
                    <td>{{entity.finalmoney[6]}}</td>
                    <td>{{entity.finalmoney[7]}}</td>
                    <td>{{entity.finalmoney[8]}}</td>
                    <td></td>
                </tr>
                <tr class="tempTr2">
                    <td>工&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;程&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;款&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;增&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;减&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;合&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计</td>
                    <td>￥</td>
                    <td>{{entity.constructionfund[0]}}</td>
                    <td>{{entity.constructionfund[1]}}</td>
                    <td>{{entity.constructionfund[2]}}</td>
                    <td>{{entity.constructionfund[3]}}</td>
                    <td>{{entity.constructionfund[4]}}</td>
                    <td>{{entity.constructionfund[5]}}</td>
                    <td>{{entity.constructionfund[6]}}</td>
                    <td>{{entity.constructionfund[7]}}</td>
                    <td>{{entity.constructionfund[8]}}</td>
                    <td>{{entity.constructionfund[9]}}</td>
                </tr>
                <tr class="tempTr2">
                    <td>收&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;款&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;合&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;计</td>
                    <td>￥</td>
                    <td>{{entity.receipt[0]}}</td>
                    <td>{{entity.receipt[1]}}</td>
                    <td>{{entity.receipt[2]}}</td>
                    <td>{{entity.receipt[3]}}</td>
                    <td>{{entity.receipt[4]}}</td>
                    <td>{{entity.receipt[5]}}</td>
                    <td>{{entity.receipt[6]}}</td>
                    <td>{{entity.receipt[7]}}</td>
                    <td>{{entity.receipt[8]}}</td>
                    <td>{{entity.receipt[9]}}</td>
                </tr>
                <tr class="tempTr2">
                    <td colspan="12" style=" text-align: left;font-size: 20px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        应收余额（人民币）&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;大写:&nbsp;&nbsp;{{entity.remainingbig}}
                        <div style="float: right; display: flex;"><div style="font-size: 20px;">小写:&nbsp;&nbsp;￥：</div><div style="width: 180px; height: 30px; border-bottom: solid #000000 1px; text-align: center;">{{entity.remaining}}</div></div>
                    </td>
                </tr>
            </table>
            <div style="width: 100%; display: flex; height: 40px;">
                <div style="width: 50%; height: 40px; line-height: 40px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;项目经理名：&nbsp;&nbsp;{{entity.manangername}}</div>
                <div style="width: 50%; height: 40px; line-height: 40px;">&nbsp;&nbsp;&nbsp;&nbsp;联系电话：&nbsp;&nbsp;{{entity.phone}}</div>
            </div>
        </div>
        <div class="end"><div style="margin-top: 160px; text-align: center; height: 230px;width: 100%;"><br/><br/><br/><br/><br/></div></div>
    </div>
    </el-card>

</div>
<style type="text/css">
    .main{width: 960px; height: 480px; margin: 0px auto; margin-top: 20px; padding: 10px; display: flex;}
    .body{width: 95%; height: 480px;}
    .title{width: 100%; height: 40px; display: flex;}
    .title .div1{width: 60%; text-align: right;}
    .title .div1 .divCtn{width: 230px; height: 40px; float: right;}
    .title .div1 .divCtn .titleCtn{width: 230px; height: 30px; line-height: 30px;text-align: center; font-size: 25px; font-weight: bold;}
    .title .div1 .divCtn .titleUdeLine{width: 230px; height: 6px; border-bottom: solid 2px #9C5223; border-top: solid 2px #9C5223;}
    .title .div2{width: 40%; text-align: right; height: 40px; line-height: 30px; font-size: 20px; font-weight: bold;}
    .date{width: 100%; height: 40px; display: flex;}
    .date .deDiv1{width: 60%; height: 40px; line-height: 40px; text-align: right; font-size: 18px;}
    .date .deDiv2{width: 40%; height: 40px;line-height: 40px;  text-align: right;font-size: 18px;}
    .tempTr1 td{text-align: center;}
    table tr td{padding: 5px;}
    .tempTr2 td{height: 40px; text-align: center;}
    .end{width: 5%; height: 480px; }
</style>

<script src="../../js/jquery.min.js"></script>
<script src="../../js/vue.min.js"></script>
<script src="../../js/element.js"></script>
<script src="../../js/tinymce/tinymce.min.js"></script>


<script>

    let urlBase = "/api/CustomerRep/";
    new Vue({
        el: "#wrapper",
        data: {
            options: [],
            fileList: [],
            user: {},
            tableData: [],
            pageNum: 1,
            pageSize: 10,
            total: 0,
            dialogFormVisible: false,
            entity: {finalmoney:"",
                constructionfund:"",
                receipt:""},
            Year:"",
            Month:"",
            Date:"",
            isCollapse: false,
            search: '',
        },
        created() {
            this.user = sessionStorage.getItem("user") ? JSON.parse(sessionStorage.getItem("user")) : {};
        },
        methods: {
            PrefixInteger00(num, length) {
                return (Array(length).join('0') + num).slice(-length)+"00";
            },
            PrefixInteger(num, length) {
                return (Array(length).join('0') + num).slice(-length);
            },
            convertCurrency(money) {
                //汉字的数字
                var cnNums = new Array('零', '壹', '贰', '叁', '肆', '伍', '陆', '柒', '捌', '玖');
                //基本单位
                var cnIntRadice = new Array('', '拾', '佰', '仟');
                //对应整数部分扩展单位
                var cnIntUnits = new Array('', '万', '亿', '兆');
                //对应小数部分单位
                var cnDecUnits = new Array('角', '分', '毫', '厘');
                //整数金额时后面跟的字符
                var cnInteger = '整';
                //整型完以后的单位
                var cnIntLast = '元';
                //最大处理的数字
                var maxNum = 999999999999999.9999;
                //金额整数部分
                var integerNum;
                //金额小数部分
                var decimalNum;
                //输出的中文金额字符串
                var chineseStr = '';
                //分离金额后用的数组，预定义
                var parts;
                if (money == '') { return ''; }
                money = parseFloat(money);
                if (money >= maxNum) {
                    //超出最大处理数字
                    return '';
                }
                if (money == 0) {
                    chineseStr = cnNums[0] + cnIntLast + cnInteger;
                    return chineseStr;
                }
                //转换为字符串
                money = money.toString();
                if (money.indexOf('.') == -1) {
                    integerNum = money;
                    decimalNum = '';
                } else {
                    parts = money.split('.');
                    integerNum = parts[0];
                    decimalNum = parts[1].substr(0, 4);
                }
                //获取整型部分转换
                if (parseInt(integerNum, 10) > 0) {
                    var zeroCount = 0;
                    var IntLen = integerNum.length;
                    for (var i = 0; i < IntLen; i++) {
                        var n = integerNum.substr(i, 1);
                        var p = IntLen - i - 1;
                        var q = p / 4;
                        var m = p % 4;
                        if (n == '0') {
                            zeroCount++;
                        } else {
                            if (zeroCount > 0) {
                                chineseStr += cnNums[0];
                            }
                            //归零
                            zeroCount = 0;
                            chineseStr += cnNums[parseInt(n)] + cnIntRadice[m];
                        }
                        if (m == 0 && zeroCount < 4) {
                            chineseStr += cnIntUnits[q];
                        }
                    }
                    chineseStr += cnIntLast;
                }
                //小数部分
                if (decimalNum != '') {
                    var decLen = decimalNum.length;
                    for (var i = 0; i < decLen; i++) {
                        var n = decimalNum.substr(i, 1);
                        if (n != '0') {
                            chineseStr += cnNums[Number(n)] + cnDecUnits[i];
                        }
                    }
                }
                if (chineseStr == '') {
                    chineseStr += cnNums[0] + cnIntLast + cnInteger;
                } else if (decimalNum == '') {
                    chineseStr += cnInteger;
                }
                return chineseStr;
            },
            generateTable()
            {
                $.get(urlBase + "/generate?id=" + this.search).then(res => {
                    this.entity=res.data;
                    if (res.code==='0') {
                        this.entity.id=this.PrefixInteger(this.entity.id,7);
                        var d = new Date();
                        this.Year=d.getFullYear();
                        this.Month = d.getMonth();
                        this.Date = d.getDate();
                        this.entity.communityid=this.PrefixInteger(this.entity.communityid,3);
                        this.entity.finalmoney=this.PrefixInteger00(this.entity.finalmoney,7);
                        this.entity.constructionfund=this.PrefixInteger00(this.entity.constructionfund,7);
                        this.entity.receipt=this.PrefixInteger00(this.entity.receipt,7);
                        this.entity.remaining=this.entity.remaining+".00";
                        this.entity.remainingbig=this.convertCurrency(this.entity.remaining);
                        this.$message({
                            message: "操作成功",
                            type: "success"
                        });
                        return;
                    }
                    else if(res.code==="-1")
                        {
                            this.entity={id:"",
                                finalmoney:[""],
                                constructionfund:[""],
                                receipt:[""]};
                            this.Year="";
                            this.Month = "";
                            this.Date = "";
                        this.$message({
                            message: "无此项目",
                            type: "error"
                        });
                        return;
                    }
                })
            },
            logout() {
                $.get("/api/user/logout");
                sessionStorage.removeItem("user");
                location.href = "/page/end/login.html";
            },
            exp() {   // excel 导出
                window.open(urlBase + "/export");
            }
        }
    })
</script>
</body>
</html>
